<!-- 此文件由机器翻译自 bedspace.md -->

# BEDspace：联合区域和元数据嵌入

## 概述

BEDspace 将 StarSpace 模型应用于基因组数据，从而能够在共享低维空间中同时训练区域集及其元数据标签的数值嵌入。这允许跨区域和元数据进行丰富的查询。

## 何时使用

在处理以下情况时使用 BEDspace：
- 具有相关元数据的区域集（细胞类型、组织、条件）
- 需要元数据感知相似性的搜索任务
- 跨模式查询（例如，“查找与标签 X 相似的区域”）
- 基因组内容和实验条件的联合分析

## 工作流程

BEDspace 由四个顺序操作组成：

### 1. 预处理

设置 StarSpace 训练的基因组间隔和元数据的格式：

```bash
geniml bedspace preprocess \
  --input /path/to/regions/ \
  --metadata labels.csv \
  --universe universe.bed \
  --labels "cell_type,tissue" \
  --output preprocessed.txt
```

**所需文件：**
- **输入文件夹**：包含 BED 文件的目录
- **元数据 CSV**：必须包含与 BED 文件名匹配的 `file_name` 列以及元数据列
- **Universe 文件**：用于标记化的参考 BED 文件
- **标签**：要使用的元数据列的逗号分隔列表

预处理步骤向元数据添加 `__label__` 前缀，并将区域转换为 StarSpace 兼容格式。

### 2. 火车

对预处理数据执行 StarSpace 模型：

<<<代码块_1>>>

**关键训练参数：**
- `--dim`：嵌入维度（典型值：50-200）
- `--epochs`：训练时期（典型：20-100）
- `--lr`：学习率（典型值：0.01-0.1）

### 3.距离

计算区域集和元数据标签之间的距离度量：

<<<代码块_2>>>

此步骤创建相似性搜索所需的距离矩阵。

### 4. 搜索

在三种场景中检索相似的项目：

**Region-to-Label (r2l)**：查询区域集→检索相似的元数据标签
<<<代码块_3>>>

**Label-to-Region (l2r)**：查询元数据标签→检索相似的区域集
<<<代码块_4>>>

**Region-to-Region (r2r)**：查询区域集→检索相似的区域集
<<<代码块_5>>>

`-n` 参数控制返回结果的数量。

## Python API

<<<代码块_6>>>

## 最佳实践

- **元数据结构**：确保元数据 CSV 包含与 BED 文件名完全匹配的 `file_name` 列（无路径）
- **标签选择**：选择捕获感兴趣的生物变异的信息丰富的元数据列
- **Universe 一致性**：在预处理、距离和任何后续分析中使用相同的 Universe 文件
- **验证**：在投资培训之前预处理并检查输出格式
- **StarSpace 安装**：单独安装 StarSpace，因为它是外部依赖项

## 输出解释

搜索结果返回按联合嵌入空间中的相似度排序的项目：
- **r2l**：标识表征查询区域的元数据标签
- **l2r**：查找与您的元数据标准匹配的区域集
- **r2r**：发现具有相似基因组内容的区域集

## 要求

BEDspace 需要单独安装 StarSpace。下载地址：https://github.com/facebookresearch/StarSpace