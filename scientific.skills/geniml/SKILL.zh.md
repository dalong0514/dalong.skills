<!-- 此文件由机器翻译自 SKILL.md -->

---
名称： 吉尼姆尔
描述：在处理机器学习任务的基因组区间数据（BED 文件）时应使用此技能。用于训练区域嵌入（Region2Vec、BEDspace）、单细胞 ATAC-seq 分析 (scEmbed)、构建共识峰（宇宙）或任何基于 ML 的基因组区域分析。适用于 BED 文件集合、scATAC-seq 数据、染色质可及性数据集和基于区域的基因组特征学习。
---

# Geniml：基因组区间机器学习

## 概述

Geniml 是一个 Python 包，用于根据 BED 文件的基因组间隔数据构建机器学习模型。它提供了用于学习基因组区域、单细胞和元数据标签嵌入的无监督方法，从而实现相似性搜索、聚类和下游 ML 任务。

## 安装

使用 uv 安装 geniml：

```bash
uv uv pip install geniml
```

对于 ML 依赖项（PyTorch 等）：

<<<代码块_1>>>

来自 GitHub 的开发版本：

<<<代码块_2>>>

## 核心能力

Geniml 提供五种主要功能，每项功能都在专用参考文件中详细介绍：

### 1. Region2Vec：基因组区域嵌入

使用 word2vec 式学习训练基因组区域的无监督嵌入。

**用途：** BED 文件的降维、区域相似性分析、下游 ML 的特征向量。

**工作流程：**
1. 使用 Universe 引用对 BED 文件进行标记
2. 在 token 上训练 Region2Vec 模型
3. 生成区域的嵌入

**参考：** 请参阅 `references/region2vec.md` 了解详细的工作流程、参数和示例。

### 2. BEDspace：联合区域和元数据嵌入

使用 StarSpace 训练区域集和元数据标签的共享嵌入。

**用于：**元数据感知搜索、跨模式查询（区域→标签或标签→区域）、基因组内容和实验条件的联合分析。

**工作流程：**
1. 预处理区域和元数据
2. 训练BEDspace模型
3. 计算距离
4、跨区域、跨标签查询

**参考：** 请参阅 `references/bedspace.md` 了解详细的工作流程、搜索类型和示例。

### 3. scEmbed：单细胞染色质可及性嵌入

在单细胞 ATAC-seq 数据上训练 Region2Vec 模型以进行细胞级嵌入。

**用途：** scATAC-seq 聚类、细胞类型注释、单细胞降维、与 scanpy 工作流程集成。

**工作流程：**
1. 准备AnnData和峰值坐标
2. 预标记单元格
3. 训练 scEmbed 模型
4. 生成单元嵌入
5. 使用 scanpy 进行聚类和可视化

**参考：** 请参阅 `references/scembed.md` 了解详细的工作流程、参数和示例。

### 4.共识高峰：宇宙构建

使用多种统计方法从 BED 文件集合构建参考峰值集（宇宙）。

**用途：** 创建标记化参考、标准化数据集中的区域、定义具有统计严谨性的共识特征。

**工作流程：**
1.合并BED文件
2. 生成覆盖轨迹
3. 使用CC、CCF、ML或HMM方法构建Universe

**方法：**
- **CC（覆盖截止）**：基于简单阈值
- **CCF（灵活覆盖截止）**：边界的置信区间
- **ML（最大似然）**：位置的概率建模
- **HMM（隐马尔可夫模型）**：复杂状态建模

**参考：**方法比较、参数和示例参见`references/consensus_peaks.md`。

### 5. 实用程序：支持工具

用于缓存、随机化、评估和搜索的附加工具。

**可用的实用程序：**
- **BBClient**：BED 文件缓存以供重复访问
- **BEDshift**：随机化保留基因组背景
- **评估**：嵌入质量指标（轮廓、Davies-Bouldin 等）
- **标记化**：区域标记化实用程序（硬、软、基于宇宙）
- **Text2BedNN**：用于基因组查询的神经搜索后端

**参考：** 请参阅`references/utilities.md`了解每个实用程序的详细用法。

## 常见工作流程

### 基本区域嵌入管道

<<<代码块_3>>>

### scATAC-seq 分析流程

<<<代码块_4>>>

### 宇宙构建和评估

<<<代码块_5>>>

## CLI 参考

Geniml 提供主要操作的命令行界面：

<<<代码块_6>>>

## 何时使用哪种工具

**在以下情况下使用 Region2Vec：**
- 处理大量基因组数据（ChIP-seq、ATAC-seq 等）
- 需要无元数据的无监督嵌入
- 比较不同实验的区域集
- 构建下游监督学习的功能

**在以下情况下使用 BEDspace：**
- 可用元数据标签（细胞类型、组织、条件）
- 需要通过元数据查询区域，反之亦然
- 想要区域和标签的联合嵌入空间
- 建立可搜索的基因组数据库

**在以下情况下使用 scEmbed：**
- 分析单细胞 ATAC-seq 数据
- 通过染色质可及性对细胞进行聚类
- 从 scATAC-seq 注释细胞类型
- 需要与 scanpy 集成

**在以下情况下使用宇宙构建：**
- 需要参考峰值集进行标记化
- 将多个实验结合成共识
- 想要统计上严格的区域定义
- 为项目建立标准参考

**在以下情况下使用实用程序：**
- 需要缓存远程BED文件（BBClient）
- 生成用于统计的空模型（BEDshift）
- 评估嵌入质量（Evaluation）
- 构建搜索界面（Text2BedNN）

## 最佳实践

### 一般准则

- **宇宙质量至关重要**：投入时间构建全面、结构良好的宇宙
- **标记化验证**：训练前检查覆盖率（>80% 理想）
- **参数调整**：尝试嵌入维度、学习率和训练周期
- **评估**：始终使用多个指标和可视化来验证嵌入
- **文档**：记录参数和随机种子以实现可重复性

### 性能考虑因素

- **预标记化**：对于 scEmbed，始终对单元进行预标记化以加快训练速度
- **内存管理**：大型数据集可能需要批处理或下采样
- **计算资源**：ML/HMM 宇宙方法属于计算密集型
- **模型缓存**：使用BBClient避免重复下载

### 集成模式

- **使用 scanpy**：scEmbed 嵌入无缝集成为 `adata.obsm` 条目
- **使用 BEDbase**：使用 BBClient 访问远程 BED 存储库
- **With Hugging Face**：导出经过训练的模型以实现共享和可重复性
- **使用 R**：使用 reticulate 进行 R 集成（请参阅实用程序参考）

## 相关项目

Geniml 是 BEDbase 生态系统的一部分：

- **BEDbase**：基因组区域的统一平台
- **BEDboss**：BED 文件的处理管道
- **Gtars**：基因组工具和实用程序
- **BBClient**：BEDbase 存储库的客户端

## 其他资源

- **文档**：https://docs.bedbase.org/geniml/
- **GitHub**：https://github.com/databio/geniml
- **预训练模型**：可在 Hugging Face（databio 组织）上使用
- **出版物**：在文档中引用方法细节

## 故障排除

**“代币化覆盖率太低”：**
- 检查宇宙质量和完整性
- 调整 p 值阈值（尝试 1e-6 而不是 1e-9）
- 确保宇宙与基因组组装相匹配

**“训练不收敛”：**
- 调整学习率（尝试0.01-0.05范围）
- 增加训练次数
- 检查数据质量和预处理

**“内存不足错误”：**
- 减少 scEmbed 的批量大小
- 分块处理数据
- 对单细胞数据使用预标记化

**“未找到 StarSpace”（BEDspace）：**
- 单独安装StarSpace：https://github.com/facebookresearch/StarSpace
- 正确设置`--path-to-starspace`参数

有关详细的故障排除和特定于方法的问题，请查阅相应的参考文件。