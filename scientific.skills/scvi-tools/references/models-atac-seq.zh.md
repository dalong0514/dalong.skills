<!-- 此文件由机器翻译自 models-atac-seq.md -->

# ATAC-seq 和染色质可及性模型

本文档涵盖了在 scvi 工具中分析单细胞 ATAC-seq 和染色质可及性数据的模型。

## 巅峰VI

**目的**：使用峰值计数分析和整合单细胞 ATAC-seq 数据。

**主要特点**：
- 专为 scATAC-seq 峰值数据设计的变分自动编码器
- 学习染色质可及性的低维表示
- 跨样本执行批量校正
- 启用差异可访问性测试
- 集成多个ATAC-seq数据集

**何时使用**：
- 分析 scATAC-seq 峰值计数矩阵
- 整合多个ATAC-seq实验
- 染色质可及性数据的批量校正
- ATAC-seq 降维
- 细胞类型或条件之间的差异可达性分析

**数据要求**：
- 峰计数矩阵（细胞×峰）
- 用于峰值可访问性的二进制或计数数据
- 批次/样本注释（可选，用于批次校正）

**基本用法**：
```python
import scvi

# Prepare data (peaks should be in adata.X)
# Optional: filter peaks
sc.pp.filter_genes(adata, min_cells=3)

# Setup data
scvi.model.PEAKVI.setup_anndata(
    adata,
    batch_key="batch"
)

# Train model
model = scvi.model.PEAKVI(adata)
model.train()

# Get latent representation (batch-corrected)
latent = model.get_latent_representation()
adata.obsm["X_PeakVI"] = latent

# Differential accessibility
da_results = model.differential_accessibility(
    groupby="cell_type",
    group1="TypeA",
    group2="TypeB"
)
```

**关键参数**：
- `n_latent`：潜在空间的维数（默认值：10）
- `n_hidden`：每个隐藏层的节点数（默认值：128）
- `n_layers`：隐藏层数（默认值：1）
- `region_factors`：是否学习区域特定因素（默认值：True）
- `latent_distribution`：潜在空间的分布（“正常”或“ln”）

**输出**：
- `get_latent_representation()`：单元格的低维嵌入
- `get_accessibility_estimates()`：标准化的可访问性值
- `differential_accessibility()`：差异峰的统计测试
- `get_region_factors()`：特定于峰值的缩放因子

**最佳实践**：
1. 滤除低质量峰（存在于极少数细胞中）
2. 如果整合多个样品，请包含批次信息
3. 使用潜在表示进行聚类和 UMAP 可视化
4. 对于技术变化较大的数据集，考虑使用 `region_factors=True`
5. 将潜在嵌入存储在 `adata.obsm` 中，以便使用 scanpy 进行下游分析

## 泊松VI

**目的**：scATAC-seq 片段计数的定量分析（比峰值计数更详细）。

**主要特点**：
- 直接模型片段计数（不仅仅是峰值存在/不存在）
- 计数数据的泊松分布
- 捕捉可访问性的数量差异
- 能够对染色质状态进行细粒度分析

**何时使用**：
- 分析片段级 ATAC-seq 数据
- 需要定量的可达性测量
- 比二元峰调用更高分辨率的分析
- 研究染色质可及性的逐渐变化

**数据要求**：
- 片段计数矩阵（细胞×基因组区域）
- 计数数据（非二进制）

**基本用法**：
<<<代码块_1>>>

**与 PeakVI 的主要区别**：
- **PeakVI**：最适合标准峰计数矩阵，速度更快
- **PoissonVI**：最适合定量碎片计数，更详细

**何时选择 PoissonVI 而不是 PeakVI**：
- 使用碎片计数而不是称为峰值
- 需要捕捉数量差异
- 拥有高质量、高覆盖率的数据
- 对微妙的可访问性变化感兴趣

## sc巴塞特

**目的**：具有可解释性和基序分析的 scATAC-seq 分析深度学习方法。

**主要特点**：
- 用于基于序列的分析的卷积神经网络 (CNN) 架构
- 模拟原始 DNA 序列，而不仅仅是峰值计数
- 实现基序发现和转录因子 (TF) 结合预测
- 提供可解释的特征重要性
- 执行批量校正

**何时使用**：
- 想要整合DNA序列信息
- 对 TF 基序分析感兴趣
- 需要可解释的模型（其序列驱动可访问性）
- 分析调控元件和 TF 结合位点
- 仅根据序列预测可访问性

**数据要求**：
- 峰序列（从基因组中提取）
- 峰值可达性矩阵
- 基因组参考（用于序列提取）

**基本用法**：
<<<代码块_2>>>

**关键参数**：
- `n_latent`：潜在空间维度
- `conv_layers`：卷积层数
- `n_filters`：每个转换层的过滤器数量
- `filter_size`：卷积滤波器的大小

**高级功能**：
- **计算机诱变**：预测序列变化如何影响可访问性
- **基序富集**：识别可访问区域中丰富的 TF 基序
- **批量校正**：与其他 scvi-tools 模型类似
- **迁移学习**：在新数据集上进行微调
**可解释性工具**：
<<<代码块_3>>>

## ATAC-seq 的模型选择

### 巅峰VI
**选择时间**：
- 标准 scATAC-seq 分析工作流程
- 具有峰值计数矩阵（最常见的格式）
- 需要快速、高效的批量校正
- 想要简单的差异可访问性
- 优先考虑计算效率

**优点**：
- 快速训练和推理
- scATAC-seq 的良好记录
- 与 scanpy 工作流程轻松集成
- 强大的批量校正

### 泊松VI
**选择时间**：
- 拥有片段级计数数据
- 需要定量的可达性措施
- 对细微差别感兴趣
- 拥有高覆盖、高质量的数据

**优点**：
- 更详细的定量信息
- 更适合渐变变化
- 适当的计数统计模型

### sc巴塞特
**选择时间**：
- 想要整合DNA序列
- 需要生物学解释（基序、转录因子）
- 对监管机制感兴趣
- 拥有用于 CNN 训练的计算资源
- 想要对新序列有预测能力

**优点**：
- 基于序列的、生物学上可解释的
- 内置Motif和TF分析
- 预测建模能力
- 计算机微扰实验

## 工作流程示例：完整的 ATAC-seq 分析

<<<代码块_4>>>

## 与基因表达整合 (RNA+ATAC)

对于配对多模式数据（来自相同细胞的 RNA+ATAC），请使用 **MultiVI** 代替：

<<<代码块_5>>>

有关多模式集成的更多详细信息，请参阅 `models-multimodal.md`。

## ATAC-seq 分析的最佳实践

1. **质量控制**：
   - 过滤峰值计数非常低或非常高的细胞
   - 去除极少数细胞中存在的峰
   - 如果需要，过滤线粒体和性染色体峰

2. **批量修正**：
   - 如果集成多个样本，则始终包含 `batch_key`
   - 考虑技术协变量（测序深度、TSS 富集）

3. **功能选择**：
   - 与 RNA-seq 不同，经常使用所有峰
   - 考虑过滤非常罕见的峰值以提高效率

4. **潜在维度**：
   - 根据数据集复杂性从 `n_latent=10-30` 开始
   - 更大的值适用于更多异构数据集

5. **下游分析**：
   - 使用潜在表示进行聚类和可视化
   - 将峰与基因联系起来进行调控分析
   - 对簇特定峰进行基序富集

6. **计算考虑因素**：
   - ATAC-seq 矩阵通常非常大（许多峰值）
   - 考虑对初始探索的峰值进行下采样
   - 对大型数据集使用 GPU 加速