<!-- 此文件由机器翻译自 retrosynthesis.md -->

# 逆合成

## 概述

逆合成是规划从目标分子回到市售起始材料的合成路线的过程。 TorchDrug 提供了基于学习的逆合成预测工具，将复杂的任务分解为可管理的子任务。

## 可用数据集

### USPTO-50K

逆合成的标准基准数据集源自美国专利文献。

**统计数据：**
- 50,017 个反应示例
- 单步反应
- 过滤质量和规范化
- 包含用于反应中心识别的原子映射

**反应类型：**
- 多样化的有机反应
- 类似药物的转化
- 常见反应类别之间的良好平衡

**数据分割：**
- 训练：~40k 反应
- 验证：~5k 反应
- 测试：~5k 反应

**格式：**
- 产品 → 反应物
- 微笑代表
- 用于训练的原子映射反应

## 任务类型

TorchDrug 将逆合成分解为多步骤流程：

### 1. 中心识别

识别反应中心 - 在正向反应中形成/断裂哪些键。

**输入：** 产品分子
**输出：** 每个键成为反应中心一部分的概率

**目的：**
- 找到化学反应发生的地方
- 指导后续合成子生成
- 大幅减少搜索空间

**模型架构：**
- 产品分子上的图神经网络
- 边缘级分类
- 突出反应区域的注意机制

**评估指标：**
- **Top-K Accuracy**：Top K 预测中的正确反应中心
- **债券级别 F1**：债券预测的精确度和召回率

### 2.SynthonCompletion

给定产物和确定的反应中心，预测反应物结构（合成子）。

**输入：**
- 产品分子
- 确定的反应中心（断裂/形成的键）

**输出：**
- 预测的反应物分子（合成子）

**流程：**
1. 在反应中心断裂键
2.修改原子环境（化合价、电荷）
3. 确定离去基团和保护基团
4. 生成完整的反应物结构

**挑战：**
- 多个有效反应物组
- 立体定向性
- 原子环境变化（杂化、电荷）
- 离去基团选择

**评价：**
- **精确匹配**：生成的反应物与地面真实情况完全匹配
- **Top-K 准确度**：正确预测 Top K 中的反应物
- **化学有效性**：生成的分子有效

### 3.逆合成（端到端）

将中心识别和合成子完成结合到统一的管道中。

**输入：** 目标产物分子
**输出：**反应物组的排名列表（合成途径）

**工作流程：**
1. 识别top-K反应中心
2. 对于每个中心，生成候选反应物
3. 按模型置信度对组合进行排名
4. 筛选商业可用性和可行性

**优点：**
- 训练和部署单一模型
- 子任务联合优化
- 考虑了中心识别的误差传播

## 培训工作流程

### 基本管道

```python
from torchdrug import datasets, models, tasks

# Load dataset
dataset = datasets.USPTO50k("~/retro-datasets/")

# For center identification
model_center = models.RGCN(
    input_dim=dataset.node_feature_dim,
    num_relation=dataset.num_bond_type,
    hidden_dims=[256, 256, 256]
)

task_center = tasks.CenterIdentification(
    model_center,
    top_k=3  # Consider top 3 reaction centers
)

# For synthon completion
model_synthon = models.GIN(
    input_dim=dataset.node_feature_dim,
    hidden_dims=[256, 256, 256]
)

task_synthon = tasks.SynthonCompletion(
    model_synthon,
    center_topk=3,  # Use top 3 from center identification
    num_synthon_beam=5  # Beam search for synthon generation
)

# End-to-end
task_retro = tasks.Retrosynthesis(
    model=model_center,
    synthon_model=model_synthon,
    center_topk=5,
    num_synthon_beam=10
)
```

### 迁移学习

对大型反应数据集（例如，USPTO-full 包含 1M+ 反应）进行预训练，然后对特定反应类别进行微调。

**好处：**
- 更好地概括罕见的反应类型
- 改进了小数据集上的性能
- 了解一般反应模式

### 多任务学习

联合培训：
- 正向反应预测
- 逆合成
- 反应类型分类
- 产量预测

**优点：**
- 化学的共享表示
- 更好的样品效率
- 提高稳健性

## 模型架构

### 图神经网络

**RGCN（关系图卷积网络）：**
- 处理多种键类型（单键、双键、三键、芳香键）
- 边类型特定的转换
- 有利于反应中心识别

**GIN（图同构网络）：**
- 强大的消息传递
- 捕捉结构模式
- 非常适合合成子完成

**GAT（图注意力网络）：**
- 注意力权重突出重要的原子/键
- 可解释的反应中心预测
- 灵活适用于各种反应类型

### 基于序列的模型

**变压器型号：**
- SMILES 到 SMILES 的翻译
- 可以捕获远程依赖关系
- 需要大数据集

**LSTM/GRU：**
- 反应物的序列生成
- 自回归解码
- 适合小分子

### 混合方法

组合图和序列表示：
- 产品的图形编码器
- 反应物序列解码器
- 两种表现中最好的

## 反应化学注意事项

### 反应等级

**常见转换：**
- C-C键形成（偶联、加成）
- 官能团相互转化（氧化、还原）
- 杂环合成（环化）
- 保护/去保护
- 芳香族替代品

**罕见反应：**
- 新颖的耦合方法
- 复杂的重新排列
- 多组分反应

### 选择性问题

**区域选择性：**
- 哪个位置对分子发生反应
- 需要了解电子学和空间学

**立体选择性：**
- 立体化学的控制
- 非对映选择性和对映选择性
- 对药物合成至关重要

**化学选择性：**
- 哪个官能团发生反应
- 需要保护群体策略

### 反应条件

虽然 TorchDrug 专注于反应连接性，但请考虑：
- 温度和压力
- 催化剂和试剂
- 溶剂
- 反应时间
- 后处理和纯化

## 多步骤综合规划

### 单步逆合成

预测目标分子的直接前体。

**使用案例：**
- 后期转型
- 简单分子（距离商业化1-2步）
- 初步勘察路线

### 多步骤规划

递归地将逆合成应用于每个预测的反应物，直到达到商业构建块。

**树搜索策略：**

**广度优先搜索：**
- 探索相同深度的所有路线
- 寻找最短路线
- 内存密集型

**深度优先搜索：**
- 按照每条路线完成
- 内存高效
- 可能会错过最佳路线

**蒙特卡罗树搜索 (MCTS)：**
- 平衡探索和开发
- 以模型置信度为指导
- 最先进的多步骤规划

**A\* 搜索：**
- 启发式搜索
- 优化成本、复杂性或可行性
- 有效寻找最佳路线

### 路线评分

按以下方式对合成路线进行排名：
1. **步骤数**：越少越好（效率）
2. **收敛与线性**：优先采用收敛路径
3. **商业可用性**：可购买化合物需要多少步骤
4. **反应可行性**：每个步骤有效的可能性
5. **总体良率**：估计的端到端良率
6. **成本**：试剂、人工、设备
7. **绿色化学**：环境影响、安全

### 停止标准

当达到以下值时停止逆合成：
- **商业化合物**：可从供应商处获得（例如 Sigma-Aldrich、Enamine）
- **构建模块**：标准合成中间体
- **最大深度**：例如，6-10 步
- **低置信度**：模型不确定性太高

## 验证和过滤

### 化学有效性

检查每个预测的反应：
- 反应物是有效分子
- 反应在化学上是合理的
- 原子映射是一致的
- 化学计量天平

### 合成可行性

**过滤器：**
- 反应先例（文献示例）
- 官能团兼容性
- 典型反应条件
- 预期产量范围

**专家系统：**
- 基于规则的验证（例如，ARChem Route Designer）
- 检查不兼容的官能团
- 确定保护/解除保护需求

### 商业可用性

**数据库：**
- eMolecules：10M+ 商业化合物
- ZINC：带有供应商信息注释
- Reaxys：市售构建块

**注意事项：**
- 每克成本
- 纯度和质量
- 交货时间
- 最小订购量

## 与其他工具集成

### 反应预测（正向）

训练正向反应预测模型以验证逆合成方案：
- 预测拟议反应物的产物
- 验证反应可行性
- 估计产量

### 逆合成软件

**集成：**
- SciFinder (CAS)
- Reaxys（爱思唯尔）
- ARChem 路线设计师
- IBM RXN 化学版

**TorchDrug 作为组件：**
- 在更大的规划系统中使用 TorchDrug 模型
- 将机器学习预测与基于规则的系统相结合
- 混合人工智能+专家系统方法

### 实验验证

**高通量筛选：**
- 快速测试预测反应
- 自动化合成平台
- 改进模型的反馈循环

**机器人合成：**
- 自动执行计划路线
- 实时优化
- 用于模型改进的数据生成

## 最佳实践

1. **集成预测**：使用多个模型来提高鲁棒性
2. **反应验证**：始终按照化学规则进行验证
3. **商业检查**：尽早验证构建块的可用性
4. **多样性**：生成多个不同的路由，而不仅仅是top-1
5. **专家评审**：让化学家评估提议的路线
6. **文献检索**：检查关键步骤的先例
7. **迭代细化**：通过实验反馈更新模型
8. **可解释性**：理解模型建议每个步骤的原因
9. **边缘情况**：处理不寻常的功能组和支架
10. **基准测试**：与已知合成路线进行比较

## 常见应用

### 药物合成规划

- 小分子药物
- 天然产物全合成
- 后期功能化策略

### 库枚举

- 虚拟图书馆设计
- 生成分子的逆合成过滤
- 优先考虑可合成的化合物

### 工艺化学

- 大规模合成的路线探索
- 成本优化
- 绿色化学替代品

### 合成方法开发

- 确定合成方法中的差距
- 指导新反应的开发
- 扩展逆合成模型功能

## 挑战和未来方向

### 当前限制

- 仅限于单步预测（大多数模型）
- 没有明确考虑反应条件
- 立体化学处理具有挑战性
- 罕见反应类型代表性不足

### 活跃的研究领域

- 端到端的多步骤规划
- 纳入反应条件
- 立体选择性逆合成
- 与机器人集成以实现闭环优化
- 半模板方法（平衡模板和无模板）
- 预测的不确定性量化

### 新兴技术

- 化学大型语言模型（ChemGPT、MolT5）
- 路线优化的强化学习
- 用于远程交互的图形转换器
- 反应数据库的自监督预训练