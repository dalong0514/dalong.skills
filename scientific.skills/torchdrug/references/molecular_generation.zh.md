<!-- 此文件由机器翻译自 molecular_generation.md -->

# 分子生成

## 概述

分子生成涉及创建具有所需特性的新颖分子结构。 TorchDrug 支持无条件生成（探索化学空间）和条件生成（优化特定属性）。

## 任务类型

### 自回归一代

通过顺序添加原子和键来逐步生成分子。这种方法可以在生成过程中实现细粒度控制和属性优化。

**主要特点：**
- 顺序原子键构建
- 支持生成期间的属性优化
- 可以纳入化学有效性限制
- 实现多目标优化

**生成策略：**
1. **Beam Search**：在每一步保留 top-k 候选者
2. **采样**：多样性的概率选择
3. **贪婪**：总是选择概率最高的动作

**属性优化：**
- 基于所需属性的奖励塑造
- 实时约束满足
- 多目标平衡（例如效力+药物相似性）

### GCPNGGeneration（图卷积策略网络）

使用强化学习来生成针对特定属性进行优化的分子。

**组件：**
1. **策略网络**：决定采取哪种行动（添加原子、添加键）
2. **奖励功能**：评估生成的分子质量
3. **训练**：带有策略梯度的强化学习

**优点：**
- 不可微目标的直接优化
- 可以整合复杂的领域知识
- 平衡勘探和开发

**应用：**
- 具有特定靶点的药物设计
- 具有属性限制的材料发现
- 多目标分子优化

## 生成模型

### 图自回归流

通过精确的似然计算标准化分子生成的流动模型。

**架构：**
- 耦合层将简单分布转变为复杂分子分布
- 可逆变换实现密度估计
- 支持条件生成

**主要特点：**
- 精确似然计算（相对于 VAE 的近似似然）
- 稳定的训练（对比GAN的对抗性训练）
- 通过可逆变换进行高效采样
- 可以生成具有指定属性的分子

**培训：**
- 分子数据集上的最大似然
- 用于条件生成的可选属性预测头
- 通常接受 ZINC 或 QM9 培训

**使用案例：**
- 生成多种药物样分子
- 已知分子之间的插值
- 分子空间的密度估计

## 生成工作流程

### 无条件生成

生成没有特定属性目标的多种分子。

**工作流程：**
1. 在分子数据集（例如 ZINC250k）上训练生成模型
2.学习分布的样本
3. 有效性和唯一性的后处理
4. 评估多样性指标

**评估指标：**
- **有效性**：化学有效分子的百分比
- **独特性**：有效分子中独特分子的百分比
- **新颖性**：不在训练集中的百分比
- **多样性**：使用指纹相似性的内部多样性

### 条件生成

生成针对特定特性进行优化的分子。

**财产目标：**
- **药物相似性**：LogP、QED、Lipinski 的五法则
- **可合成性**：SA评分，逆合成可行性
- **生物活性**：预测的 IC50、结合亲和力
- **ADMET**：吸收、分布、代谢、排泄、毒性
- **多目标**：同时平衡多个属性

**工作流程：**
1.结合财产目标定义奖励函数
2. 在属性上训练GCPN或条件流模型
3. 生成具有所需属性范围的分子
4. 验证生成的分子（在计算机中 → 湿实验室）

### 基于支架的生成

围绕固定支架或核心结构生成分子。

**应用：**
- 先导化合物优化保持核心药效团
- SAR 研究的 R 组枚举
- 片段链接和生长

**方法：**
- 训练期间的面罩支架
- 脚手架上的条件生成
- 世代嫁接

### 基于片段的生成

从经过验证的片段构建分子。

**好处：**
- 确保类似药物的子结构
- 减少搜索空间
- 结合药物化学知识

**方法：**
- 片段库作为构建块
- 基于词汇的生成
- 与学习的链接器进行片段链接

## 属性优化策略

### 单目标优化
最大化或最小化单个属性（例如，结合亲和力）。

**方法：**
- 定义标量奖励函数
- 使用 GCPN 进行 RL 训练
- 生成候选人并对其进行排名

**挑战：**
- 可能会牺牲其他重要属性
- 对抗性例子的风险（有效但非类药物）
- 需要对药物相似性进行限制

### 多目标优化

平衡多个竞争目标（例如效力、选择性、可合成性）。

**加权方法：**
- **线性组合**：w1×prop1 + w2×prop2 + ...
- **帕累托优化**：找到非支配解
- **约束满足**：次要目标的阈值

**目标示例：**
- 高结合亲和力（目标）
- 低结合亲和力（脱靶）
- 高综合性（SA分数）
- 类药物特性（QED）
- 低分子量

**工作流程：**
```python
from torchdrug import tasks

# Define multi-objective reward
def reward_function(mol):
    affinity_score = predict_binding(mol)
    druglikeness = calculate_qed(mol)
    synthesizability = sa_score(mol)

    # Weighted combination
    reward = 0.5 * affinity_score + 0.3 * druglikeness + 0.2 * (1 - synthesizability)
    return reward

# GCPN task with custom reward
task = tasks.GCPNGeneration(
    model,
    reward_function=reward_function,
    criterion="ppo"  # Proximal policy optimization
)
```

### 基于约束的生成

生成满足硬约束的分子。

**共同约束：**
- 分子量范围
- LogP范围
- 可旋转债券的数量
- 环数限制
- 子结构包含/排除
- 综合可访问性阈值

**实施：**
- 生成期间的有效性检查
- 尽早停止无效分子
- 奖励函数中的惩罚项

## 培训注意事项

### 数据集选择

**锌（类药物化合物）：**
- ZINC250k：250,000 种化合物
- ZINC2M：200 万种化合物
- 预先过滤药物相似性
- 适合药物发现应用

**QM9（有机小分子）：**
- 133,885 个分子
- 包括量子特性
- 适合财产预测模型

**ChEMBL（生物活性分子）：**
- 数百万种生物活性化合物
- 可用的活动数据
- 特定目标生成

**自定义数据集：**
- 专注于特定的化学空间
- 包括专业知识
- 特定领域的约束

### 数据增强

**微笑增强：**
- 为同一分子生成多个SMILES
- 帮助模型学习规范表示
- 提高稳健性

**图形增强：**
- 随机节点/边缘掩蔽
- 子图采样
- 基序替换

### 模型架构选择

**对于小分子（<30 个原子）：**
- 更简单的架构就足够了
- 更快的训练和生成
- GCN或GIN主干

**对于药物样分子：**
- 更深层次的架构（4-6层）
- 注意力机制有帮助
- 考虑分子指纹

**对于大环化合物/聚合物：**
- 处理更大的图表
- 环闭合机制很重要
- 远程依赖

## 验证和过滤

### 计算机验证

**化学有效性：**
- 化合价规则
- 芳香度规则
- 电荷中性
- 稳定的基础结构

**药物相似过滤器：**
- 利宾斯基五法则
- 韦伯的规则
- PAINS 过滤器（泛测定干扰化合物）
- BRENK 过滤器（有毒/反应性子结构）

**可合成性：**
- SA 分数（综合可达性）
- 逆合成预测
- 前体的商业可用性

**房产预测：**
- ADMET 特性
- 毒性预测
- 脱靶结合
- 代谢稳定性

### 排名和选择

**标准：**
1. 预测目标亲和力
2. 药物相似度评分
3. 综合性
4.新颖性（与已知活性物质的不同之处）
5. 多样性（生成集中）
6. 预测的 ADMET 特性

**选择策略：**
- 帕累托前沿选择
- 加权评分
- 聚类和代表性选择
- 湿实验室验证的主动学习

## 最佳实践

1. **从简单开始**：从无条件生成开始，然后添加约束
2. **验证化学**：始终检查有效分子和药物相似性
3. **多样化的训练数据**：使用大型、多样化的数据集以实现更好的泛化
4. **多目标**：从一开始就考虑多个属性
5. **迭代细化**：生成→验证→利用反馈重新训练
6. **领域专家评审**：合成前咨询药物化学家
7. **基准**：与已知活性成分和随机样本进行比较
8. **可合成性**：优先考虑实际可以制造的分子
9. **可解释性**：理解模型为何生成某些结构
10. **湿实验室验证**：最终通过实验验证有前途的候选者

## 常见应用

### 药物发现
- 新目标的潜在客户开发
- 围绕主动支架进行先导优化
- 生物等排体替代
- 片段阐述

### 材料科学
- 具有目标特性的聚合物设计
- 催化剂发现
- 储能材料
- 光伏材料

### 化学生物学
- 探针分子设计
- 降级器（PROTAC）设计
- 分子胶的发现

## 与其他工具集成

**对接：**
- 生成分子→对接目标→使用对接分数重新训练

**逆合成：**
- 通过合成可及性过滤生成的分子
- 为顶尖候选人规划合成路线

**房产预测：**
- 使用经过训练的财产预测模型作为奖励函数
- 具有生成和预测的多任务学习

**主动学习：**
- 生成候选→预测属性→综合最佳→重新训练