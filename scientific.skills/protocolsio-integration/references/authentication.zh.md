<!-- 此文件由机器翻译自 authentication.md -->

# Protocols.io 身份验证

## 概述

Protocols.io API 支持两种类型的访问令牌进行身份验证，从而可以访问公共和私有内容。

## 访问令牌类型

### 1.CLIENT_ACCESS_TOKEN

- **目的**：允许访问公共内容和客户端用户的私人内容
- **用例**：访问您自己的协议和公共协议时
- **范围**：仅限于代币所有者的私人内容以及所有公共内容

### 2.OAUTH_ACCESS_TOKEN

- **目的**：授予对特定用户的私人内容以及所有公共内容的访问权限
- **用例**：构建需要在其他用户许可的情况下访问其内容的应用程序时
- **范围**：对授权用户的私人内容以及所有公共内容的完全访问权限

## 身份验证标头

所有 API 请求都必须包含授权标头：

```
Authorization: Bearer [ACCESS_TOKEN]
```

## OAuth 流程

### 第1步：生成授权链接

将用户引导至授权 URL 以授予访问权限：

<<<代码块_1>>>

**参数：**
- `client_id`（必需）：您的应用程序的客户端 ID
- `redirect_uri`（必需）：授权后重定向用户的 URL
- `response_type`（必需）：设置为“代码”
- `state`（可选但推荐）：随机字符串以防止 CSRF 攻击

**示例：**
<<<代码块_2>>>

### 步骤 2：将授权代码交换为令牌

用户授权后，protocols.io 会使用授权码重定向到您的 `redirect_uri`。将此代码交换为访问令牌：

<<<代码块_3>>>

**参数：**
- `grant_type`：设置为“授权代码”
- `code`：收到的授权码
- `client_id`：您的应用程序的客户端 ID
- `client_secret`：您的应用程序的客户端密钥
- `redirect_uri`：必须与步骤 1 中使用的redirect_uri 匹配

**回复包括：**
- `access_token`：用于 API 请求的 OAuth 访问令牌
- `token_type`：“承载者”
- `expires_in`：令牌生命周期（以秒为单位）（通常为 1 年）
- `refresh_token`：用于刷新访问令牌的令牌

### 步骤 3：刷新访问令牌

在访问令牌过期（通常为 1 年）之前，使用刷新令牌获取新的访问令牌：

<<<代码块_4>>>

**参数：**
- `grant_type`：设置为“refresh_token”
- `refresh_token`：步骤 2 中收到的刷新令牌
- `client_id`：您的应用程序的客户端 ID
- `client_secret`：您的应用程序的客户端密钥

## 速率限制

发出 API 请求时请注意速率限制：

- **标准端点**：每个用户每分钟 100 个请求
- **PDF 端点** (`/view/[protocol-uri].pdf`)：
  - 登录用户：每分钟 5 个请求
  - 未签名用户：每分钟 3 个请求

## 最佳实践

1. **安全地存储令牌**：切勿在客户端代码或版本控制中公开访问令牌
2. **处理token过期**：实现过期前自动刷新token
3. **遵守速率限制**：针对速率限制错误实施指数退避
4. **使用状态参数**：为了安全起见，始终在 OAuth 流程中包含状态参数
5. **验证redirect_uri**：确保授权和令牌请求之间的重定向 URI 完全匹配